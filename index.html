<!DOCTYPE html>
<html>
    <head>
        <title>Basic-Map</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="index.css" rel="stylesheet" type="text/css" >
    </head>
    <body>
        <div id="vertical-tool-border"></div>
        <div id="horizontal-tool-border"></div>
        <div id="tool" onclick="toggleDimentions()">
            3D
        </div>
        <div id="tool-2" onclick="toggleZoom(event)">
            1x
        </div>


        <div id="map-wrapper">
            <div id="map-container">
            </div>
        </div>
        <script src="LLA.js"></script>
        <script src="Bbox.js"></script>
        <script src="cube.js"></script>
        <script src="desk.js"></script>
        <script src="person.js"></script>
        <script src="NavigatingPerson.js"></script>
        <script src="map.js"></script>
        <script src="office.js"></script>
        <script>
            const map = new LMap({
                rootSelector: '#map-wrapper',
                width: 65,
                height: 26,
            });
            function toggleDimentions() {
                map.toggleView();
                document.getElementById('tool').innerHTML = map.view.toUpperCase();
            }
            function toggleZoom(event) {
                const options = [10, 5, 2, 1];
                const index = options.indexOf(map.zoom);
                const nextIndex = (index + 1) % options.length;
                const nextOption = options[nextIndex];
                map.zoom = nextOption;
                event.target.innerHTML = `${map.zoom}x`;
                map.toggleView();
                map.toggleView();
            }

            const objList = [];

            const cubes = [];
            Office.forEach(item => {
                const xAxisScaling = 60;
                const yAxisScaling = 55;
                if (item.type === 'desk') {
                    const desk = new Desk(
                        (item.x + 1) * xAxisScaling,
                        (item.y + 1) * yAxisScaling,
                        item.letter,
                        item.horiz,
                    );
                    desk.addToMap(map);
                    objList.push(desk);
                } else {
                    const buildingHeight = 90;
                    const cube = new Cube({
                        x: (item.x + 1) * xAxisScaling,
                        y: (item.y + 1) * yAxisScaling,
                        colors: '#00000000,#00000000,#00000000'.split(','),
                        text: [
                            `   <div style="width:100%;height:100%;box-sizing: border-box;border:2px solid black;background-color:white;">
                                    ${item.letter}
                                </div>`,
                            `<div style="border: 4px solid black;width:100%;height:100%;box-sizing: border-box; background-color:white;"></div>`,
                            `<div style="border: 4px solid black;width:100%;height:100%;box-sizing: border-box; background-color:white;"></div>`,
                        ],
                        width: item.width * xAxisScaling,
                        depth: item.height * yAxisScaling,
                        height: buildingHeight,
                    });
                    cubes.push(cube);
                    objList.push(cube);
                }
            });
            cubes.forEach(cube => map.addItem(cube.createElement()));
            function createAnimatedPerson() {
                const start = getRandomPlaceOnMap(new Person(20, 20), map, objList);
                const goal = getRandomPlaceOnMap(new Person(20, 20), map, objList);
                const person = new Person(0, 0);
                person.setWalkAnimationLevel(0, start.x, start.y)
                person.addToMap(map);
                const navP = new NavigatingPerson(person, map, objList);
                return navP;
            }
            const navigatingPeople = Array.from({ length: 20 }, () => createAnimatedPerson());
            setInterval(() => {
                navigatingPeople.forEach(person => person.step(1));
            }, 40);
        </script>
    </body>
</html>