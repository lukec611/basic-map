<!DOCTYPE html>
<html>
    <head>
        <title>Basic-Map</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="index.css" rel="stylesheet" type="text/css" >
    </head>
    <body>
        <div id="vertical-tool-border"></div>
        <div id="horizontal-tool-border"></div>
        <div id="tool" onclick="toggleDimentions()">
            3D
        </div>


        <div id="map-wrapper">
            <div id="map-container">
            </div>
        </div>
        <script src="LLA.js"></script>
        <script src="cube.js"></script>
        <script src="desk.js"></script>
        <script src="person.js"></script>
        <script src="map.js"></script>
        <script>
            const map = new Map({
                rootSelector: '#map-wrapper',
                width: 25,
                height: 21,
            });
            function toggleDimentions() {
                map.toggleView();
                document.getElementById('tool').innerHTML = map.view.toUpperCase();
            }

            const cubes = [
                new Cube({
                    x: 8 * 42,
                    y: 8 * 42,
                    colors: '#00000000,#00000000,#00000000'.split(','),
                    text: [
                        `   <div style="width:100%;height:100%;box-sizing: border-box;border:2px solid black;">
                                Room X.Y.Z
                            </div>`,
                        `<div style="border: 4px solid black;width:100%;height:100%;box-sizing: border-box"></div>`,
                        `<div style="border: 4px solid black;width:100%;height:100%;box-sizing: border-box"></div>`,
                    ],
                    width: 200,
                    height: 90,
                }),
            ];
            cubes.forEach(cube => map.addItem(cube.createElement()));

            const desk = new Desk(400, 10, '<div style="padding:4px;font-size:12px">Luke\'s Desk</div>');
            desk.addToMap(map);
            const desk2 = new Desk(400, 110, '<div style="padding:4px;font-size:12px">Angus\' Desk</div>');
            desk2.addToMap(map);

            function addAnimatingPerson() {
                const person = new Person(20, 20);
                person.addToMap(map);
                async function personRandomWalk() {
                    function randomPlace() {
                        return {
                            x: Math.random() * map.width * 40,
                            y: Math.random() * map.height * 40,
                        };
                    }
                    async function singleIteration() {
                        const goal = randomPlace();
                        const diff = { x: goal.x - person.x, y: goal.y - person.y };
                        const dist = Math.sqrt(
                            Math.pow(diff.x, 2)
                            + Math.pow(diff.y, 2)
                        );
                        const steps = {
                            x: diff.x / dist,
                            y: diff.y / dist,
                        };
                        const angle = Math.atan2(diff.y, diff.x) * 57.3;
                        console.log(dist, steps, diff);
                        var anglee = 0;
                        const iterations = Math.floor(dist / 1);
                        for(let i = 0, wa = 0; i < iterations; i++, wa += 0.025) {
                            const newPos = {
                                x: person.x + steps.x,
                                y: person.y + steps.y,
                                // x: 20,
                                // y: 80,
                            };
                            person.setWalkAnimationLevel(wa, newPos.x, newPos.y, 0, angle);
                            anglee = (anglee+1)%360
                            // person.setWalkAnimationLevel(wa, 20, 20, 0, anglee);
                            await new Promise(r => setTimeout(r, 10));
                        }
                        singleIteration();
                    }
                    singleIteration();
                }
                personRandomWalk();
            }
            const numPeople = 7;
            for(let i = 0; i < numPeople; i++) addAnimatingPerson();


        </script>
    </body>
</html>